<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Library | Digital Library Hub</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <!-- We still need script.js for Auth and Header logic -->
  <script type="module" src="script.js"></script>
</head>
<body>
  <!-- Enhanced Header -->
  <header>
    <div class="header-container">
      <div class="header-brand">
        <div class="logo">
          <span class="logo-icon">ðŸ“š</span>
          <div class="logo-text">
            <h1>Digital Library Hub</h1>
            <span class="logo-subtitle">Your Reading Companion</span>
          </div>
        </div>
      </div>

      <nav class="navbar">
        <div class="nav-container">
          <a href="index.html" class="nav-link" data-section="home">
            <i class="fas fa-home"></i>
            <span>Home</span>
          </a>
          <a href="Featured.html" class="nav-link" data-section="featured">
            <i class="fas fa-star"></i>
            <span>Featured</span>
          </a>
          <a href="Event.html" class="nav-link" data-section="events">
            <i class="fas fa-calendar-alt"></i>
            <span>Events</span>
          </a>
          <a href="Authors.html" class="nav-link" data-section="authors">
            <i class="fas fa-user-edit"></i>
            <span>Authors</span>
          </a>
          <a href="Library.html" class="nav-link active" data-section="library">
            <i class="fas fa-book-open"></i>
            <span>My Library</span>
          </a>
        </div>
      </nav>

      <div class="header-actions">
        <!-- Kept original header actions structure -->
      
          
          <div class="user-menu">
            <button class="icon-btn user-toggle" id="accountToggle" aria-label="Account">
              <i class="fas fa-user"></i>
            </button>
            <div class="user-dropdown">
              <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span>Guest User</span>
              </div>
              <div class="dropdown-divider"></div>
              <a href="#" class="dropdown-item">
                <i class="fas fa-bookmark"></i>
                My Collections
              </a>
              <div class="dropdown-divider"></div>
              <button class="dropdown-item logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                Sign In
              </button>
            </div>
          </div>

          <button class="icon-btn mode-toggle" id="modeToggle" aria-label="Toggle Dark Mode">
            <i class="fas fa-moon"></i>
          </button>

          <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu">
            <i class="fas fa-bars"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav" id="mobileNav">
      <div class="mobile-nav-content">
        <a href="index.html" class="mobile-nav-link">
          <i class="fas fa-home"></i>
          <span>Home</span>
        </a>
        <a href="Featured.html" class="mobile-nav-link">
          <i class="fas fa-star"></i>
          <span>Featured</span>
        </a>
        <a href="Event.html" class="mobile-nav-link">
          <i class="fas fa-calendar-alt"></i>
          <span>Events</span>
        </a>
        <a href="Authors.html" class="mobile-nav-link">
          <i class="fas fa-user-edit"></i>
          <span>Authors</span>
        </a>
        <a href="Library.html" class="mobile-nav-link active">
          <i class="fas fa-book-open"></i>
          <span>My Library</span>
        </a>
        <div class="mobile-nav-actions">
          <button class="mobile-mode-toggle">
            <i class="fas fa-moon"></i>
            <span>Dark Mode</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Library Hero Section -->
  <section class="library-hero">
    <div class="hero-content">
      <h1>ðŸ“š My Personal Library</h1>
      <p>Your curated collection of literary treasures and reading adventures</p>
      <div class="library-stats">
        <div class="library-stat">
          <span class="stat-number" id="totalBooks">0</span>
          <span class="stat-label">Total Books</span>
        </div>
        <div class="library-stat">
          <span class="stat-number" id="readBooks">0</span>
          <span class="stat-label">Books Read</span>
        </div>
        <div class="library-stat">
          <span class="stat-number" id="readingBooks">0</span>
          <span class="stat-label">Currently Reading</span>
        </div>
        <div class="library-stat">
          <span class="stat-number" id="unreadBooks">0</span>
          <span class="stat-label">To Read</span>
        </div>
      </div>
    </div>
    <div class="hero-background">
      <div class="floating-icon"><i class="fas fa-book"></i></div>
      <div class="floating-icon"><i class="fas fa-bookmark"></i></div>
      <div class="floating-icon"><i class="fas fa-star"></i></div>
    </div>
  </section>

  <!-- Library Controls -->
  <section class="library-controls">
    <div class="container">
      <div class="library-filter-tabs">
        <button class="library-filter-tab active" data-filter="all">
          <i class="fas fa-th-large"></i>
          All Books
        </button>
        <button class="library-filter-tab" data-filter="reading">
          <i class="fas fa-book-open"></i>
          Currently Reading
        </button>
        <button class="library-filter-tab" data-filter="read">
          <i class="fas fa-check-circle"></i>
          Completed
        </button>
        <button class="library-filter-tab" data-filter="unread">
          <i class="fas fa-clock"></i>
          To Read
        </button>
        <button class="library-filter-tab" data-filter="favorites">
          <i class="fas fa-heart"></i>
          Favorites
        </button>
      </div>
  </section>

  <!-- Enhanced Library Section -->
  <section class="library-section">
    <div class="container">
      <!-- Reading Stats -->
      <div class="reading-stats">
        <div class="stats-grid">
          <div class="stat-card">
            <i class="fas fa-books"></i>
            <span class="number" id="statsTotalBooks">0</span>
            <span class="label">Total Books</span>
          </div>
          <div class="stat-card">
            <i class="fas fa-check-circle"></i>
            <span class="number" id="statsCompleted">0</span>
            <span class="label">Completed</span>
          </div>
          <div class="stat-card">
            <i class="fas fa-clock"></i>
            <span class="number" id="statsReading">0</span>
            <span class="label">In Progress</span>
          </div>
          <div class="stat-card">
            <i class="fas fa-trophy"></i>
            <span class="number" id="statsPages">0</span>
            <span class="label">Pages Read</span>
          </div>
        </div>
      </div>

      <!-- Books Grid -->
      <div class="books-grid" id="savedBooksContainer">
        <!-- Books will be dynamically inserted here -->
      </div>

      <!-- Empty State -->
      <div class="empty-library" id="emptyLibrary" style="display: none;">
        <div class="empty-state">
          <i class="fas fa-book-open"></i>
          <h3>Your Library Awaits</h3>
          <p>Start your reading journey by adding books to your personal collection</p>
          <a href="index.html" class="explore-btn">
            <i class="fas fa-compass"></i>
            Explore Books
          </a>
        </div>
      </div>
    </div>
  </section>
 <!-- Enhanced Footer -->
  <footer id="contact">
    <div class="footer-content">
      <div class="footer-logo">
        <h3>ðŸ“š Digital Library Hub</h3>
        <p>Your gateway to endless reading adventures</p>
      </div>
      
      <div class="footer-links">
        <div class="footer-column">
          <h4>Explore</h4>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="Featured.html">Featured Books</a></li>
            <li><a href="Library.html">My Library</a></li>
            <li><a href="Event.html">Events</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h4>Support</h4>
          <ul>
            <li><a href="#">Help Center</a></li>
            <li><a href="#">Contact Us</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>
        
        <div class="footer-column">
          <h4>Connect With Us</h4>
          <div class="footer-socials">
            <a href="#" class="social-link facebook" aria-label="Facebook">
              <i class="fab fa-facebook-f"></i>
            </a>
            <a href="#" class="social-link twitter" aria-label="Twitter">
              <i class="fab fa-twitter"></i>
            </a>
            <a href="#" class="social-link instagram" aria-label="Instagram">
              <i class="fab fa-instagram"></i>
            </a>
            <a href="#" class="social-link youtube" aria-label="YouTube">
              <i class="fab fa-youtube"></i>
            </a>
          </div>
          <div class="newsletter-signup">
            <p>Stay updated with our latest books</p>
            <form class="footer-newsletter">
              <input type="email" placeholder="Your email address" required>
              <button type="submit">Subscribe</button>
            </form>
          </div>
        </div>
      </div>
    </div>
    
    <div class="footer-bottom">
      <div class="footer-bottom-content">
        <p>&copy; 2025 Digital Library Hub. All Rights Reserved.</p>
        <div class="footer-legal">
          <a href="#">Privacy</a>
          <span class="separator">|</span>
          <a href="#">Terms</a>
          <span class="separator">|</span>
          <a href="#">Cookies</a>
        </div>
      </div>
    </div>
  </footer>


<!-- ===== LOGIN / REGISTER MODAL (paste before </body>) ===== -->
<div class="login-modal" id="loginModal" aria-hidden="true">
  <div class="login-content" role="dialog" aria-modal="true" aria-labelledby="authTitle">
    <span class="close" id="closeLoginBtn" title="Close">âœ–</span>

    <h2 id="authTitle">Access Your Library</h2>
    <p id="authSubtitle">Login to access your library</p>

    <form id="authForm" autocomplete="on">
      <div class="input-group">
        <i class="fas fa-envelope"></i>
        <input id="authEmail" type="email" required placeholder="Email">
      </div>

      <div class="input-group">
        <i class="fas fa-lock"></i>
        <input id="authPassword" type="password" required placeholder="Password">
      </div>

      <div class="form-options">
        <label class="remember-me"><input id="rememberMe" type="checkbox"> Remember me</label>
        <a class="forgot-password" href="#">Forgot?</a>
      </div>

      <div class="error-box" id="authErrorMessage"></div>

      <button id="authSubmitBtn" class="btn-login" type="submit">Login</button>
    </form>

    <p class="login-divider"><span>or continue with</span></p>

    <div class="social-login">
      <button id="googleLoginBtn" class="social-btn"><i class="fab fa-google"></i> Google</button>
      <button id="facebookLoginBtn" class="social-btn"><i class="fab fa-facebook"></i> Facebook</button>
    </div>

    <p style="margin-top:12px; font-size:.9rem; text-align:center;">
      <span id="authSwitchText">Don't have an account? </span>
      <button id="toggleAuthMode" class="btn-register" style="display:inline-block; padding:6px 10px; font-size:.9rem;">Create Account</button>
    </p>
  </div>
</div>


  <!-- Story Modal -->
  <div id="storyModal" class="story-modal" aria-hidden="true">
    <div class="reader-container" role="dialog" aria-modal="true">
      <div class="reader-header">
        <h2 id="readerTitle">Book Title</h2>
        <button id="closeModal" class="close-reader" aria-label="Close">&times;</button>
      </div>

      <div class="reader-body">
        <aside class="chapter-sidebar">
          <h3>Chapters</h3>
          <ul id="chapterList"></ul>
        </aside>

        <main class="chapter-content">
          <h3 id="chapterTitleDisplay">Select a Chapter</h3>
          <div id="storyText" class="text-scroll-area"></div>
          
          <div class="reader-nav">
            <button id="prevChapter" disabled>
              <i class="fas fa-chevron-left"></i> Previous
            </button>
            <div class="reading-progress">
              <span class="progress-text">--</span>
            </div>
            <button id="nextChapter">
              Next <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </main>
      </div>
    </div>
  </div>

  <script type="module">
  
    import { openReader } from "./script.js";
    import { getBooksFromSupabase } from "./Supabaseclient.js";
    
    // DOM elements
    const container = document.getElementById("savedBooksContainer");
    const emptyLibrary = document.getElementById("emptyLibrary");
    const totalBooksEl = document.getElementById("totalBooks");
    const readBooksEl = document.getElementById("readBooks");
    const readingBooksEl = document.getElementById("readingBooks");
    const unreadBooksEl = document.getElementById("unreadBooks");
    const statsTotalBooks = document.getElementById("statsTotalBooks");
    const statsCompleted = document.getElementById("statsCompleted");
    const statsReading = document.getElementById("statsReading");
    const statsPages = document.getElementById("statsPages");

    // VARIABLE TO STORE ACTUAL BOOK CONTENT (Chapters, etc.)
    let libraryFullContent = [];

    // Notification function
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check' : 'info'}-circle"></i><span>${message}</span>`;
      document.body.appendChild(notification);
      setTimeout(() => notification.classList.add('show'), 100);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Initialize: Fetch Real Data then Render
    async function init() {
        // Fetch real data from Supabase so we have chapters/content
        console.log("ðŸ“¥ Fetching book content for Library...");
        libraryFullContent = await getBooksFromSupabase();
        
        // After fetching, render the library
        renderLibrary();
    }

    function renderLibrary() {
      // Get saved books (Local Storage only has Title/Author/Image, NO CONTENT)
      const savedBooks = JSON.parse(localStorage.getItem("savedBooks")) || [];
      
      // Update stats
      const totalBooks = savedBooks.length;
      const readBooks = savedBooks.filter(book => book.status === 'read').length;
      const readingBooks = savedBooks.filter(book => book.status === 'reading').length;
      const unreadBooks = savedBooks.filter(book => !book.status || book.status === 'unread').length;
      const totalPages = savedBooks.reduce((sum, book) => sum + (book.pagesRead || 0), 0);

      totalBooksEl.textContent = totalBooks;
      readBooksEl.textContent = readBooks;
      readingBooksEl.textContent = readingBooks;
      unreadBooksEl.textContent = unreadBooks;
      
      statsTotalBooks.textContent = totalBooks;
      statsCompleted.textContent = readBooks;
      statsReading.textContent = readingBooks;
      statsPages.textContent = totalPages;

      container.innerHTML = "";

      if (savedBooks.length === 0) {
        emptyLibrary.style.display = 'block';
        container.style.display = 'none';
        return;
      }

      emptyLibrary.style.display = 'none';
      container.style.display = 'grid';

      savedBooks.forEach((book, index) => {
        const bookCard = document.createElement("div");
        bookCard.classList.add("book");
        bookCard.setAttribute('data-status', book.status || 'unread');
        
        const progressPercentage = book.pagesRead ? Math.min(100, Math.round((book.pagesRead / (book.totalPages || 300)) * 100)) : 0;
        
        bookCard.innerHTML = `
          <div class="book-image">
            <img src="${book.img}" alt="${book.title}" onerror="this.src='ASSETS/default.jpg'">
            <div class="book-badge ${book.status || 'unread'}">
              ${book.status === 'read' ? 'Completed' : book.status === 'reading' ? 'Reading' : 'To Read'}
            </div>
            <div class="book-actions">
              <button class="book-action-btn favorite-btn" title="Add to favorites">
                <i class="${book.favorite ? 'fas' : 'far'} fa-heart"></i>
              </button>
              <button class="book-action-btn remove-btn" title="Remove from library">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
          <div class="book-details">
            <h3 class="book-title">${book.title}</h3>
            <p class="book-author">by ${book.author}</p>
            <div class="book-meta">
              <div class="book-rating">
                <div class="rating-stars">
                  <i class="fas fa-star" style="color:gold"></i>
                  <i class="fas fa-star" style="color:gold"></i>
                  <i class="fas fa-star" style="color:gold"></i>
                  <i class="fas fa-star" style="color:gold"></i>
                  <i class="fas fa-star-half-alt" style="color:gold"></i>
                </div>
              </div>
            </div>
            <div class="book-cta">
              <button class="read-btn" data-title="${book.title}">
                <i class="fas fa-book-open"></i>
                ${book.status === 'read' ? 'Re-read' : book.status === 'reading' ? 'Continue' : 'Start Reading'}
              </button>
            </div>
          </div>
        `;

        // --- EVENT LISTENERS ---

        // 1. Remove Book
        bookCard.querySelector(".remove-btn").addEventListener("click", (e) => {
          e.stopPropagation();
          const updatedBooks = savedBooks.filter((b, i) => i !== index);
          localStorage.setItem("savedBooks", JSON.stringify(updatedBooks));
          renderLibrary();
          showNotification('Book removed from library', 'success');
        });

        // 2. Favorite Book
        bookCard.querySelector(".favorite-btn").addEventListener("click", (e) => {
          e.stopPropagation();
          savedBooks[index].favorite = !savedBooks[index].favorite;
          localStorage.setItem("savedBooks", JSON.stringify(savedBooks));
          renderLibrary();
        });

        // 3. READ BUTTON (CORRECTED LOGIC)
        const readBtn = bookCard.querySelector(".read-btn");
        readBtn.addEventListener("click", (e) => {
          e.stopPropagation();
          
          // Update status in Local Storage
          savedBooks[index].status = 'reading';
          localStorage.setItem("savedBooks", JSON.stringify(savedBooks));
          
          // FIND ACTUAL CONTENT FROM SUPABASE DATA
          const title = readBtn.getAttribute("data-title");
          
          // Try to find the book in the fetched Supabase data
          const foundBook = libraryFullContent.find(b => b.title === title);
          
          if (foundBook) {
              console.log("ðŸ“– Book found in DB:", foundBook.title);
              openReader(foundBook); // Pass the FULL book object with chapters
          } else {
              console.warn("âš ï¸ Book content not found in DB. Loading placeholder.");
              openReader({ title: title, author: book.author, chapters: [] });
          }
        });

        container.appendChild(bookCard);
      });
    }

    // Run Init on Load
    window.addEventListener('load', init);
    
    // Filter Logic
    document.querySelectorAll('.library-filter-tab').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.library-filter-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const filter = btn.getAttribute('data-filter');
        const books = document.querySelectorAll('.book');
        
        books.forEach(book => {
          const status = book.getAttribute('data-status');
          const isFavorite = book.querySelector('.favorite-btn i').classList.contains('fas');
          if (filter === 'all') book.style.display = 'grid';
          else if (filter === 'favorites') book.style.display = isFavorite ? 'grid' : 'none';
          else book.style.display = status === filter ? 'grid' : 'none';
        });
      });
    });
    
  </script> 

  <style>
    .notification {
      position: fixed;
      top: 100px;
      right: 20px;
      background: white;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      border-left: 4px solid #667eea;
    }
    .notification.show { transform: translateX(0); }
    .notification.success { border-left-color: #10b981; }
    .notification.success i { color: #10b981; }

    /* ====== LIBRARY PAGE ====== */
.library-section {
  padding: 60px 30px;
  max-width: 1000px;
  margin: auto;
  text-align: center;
}

.library-section h2 {
  color: #3a3a98;
  margin-bottom: 30px;
}

.saved-books-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 20px;
}

.book-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  padding: 15px;
  text-align: center;
  transition: transform 0.3s;
}

.book-card:hover {
  transform: scale(1.05);
}

.book-card img {
  width: 120px;
  height: 160px;
  object-fit: cover;
  margin-bottom: 10px;
  border-radius: 6px;
}

.book-actions button {
  background: #3a3a98;
  color: #fff;
  border: none;
  padding: 8px 10px;
  margin: 5px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s;
}

.book-actions button:hover {
  background: #e67e22;
}

  </style>
</body>
</html>